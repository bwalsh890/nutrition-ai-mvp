<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nutrition AI - Habit Tracker Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        .mobile-container {
            max-width: 28rem;
            margin: 0 auto;
            padding: 1.5rem 1rem;
            min-height: 100vh;
            padding-bottom: 5rem;
        }
        .btn-primary {
            background-color: #0284c7;
            color: white;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
        }
        .btn-primary:hover {
            background-color: #0369a1;
        }
        .btn-secondary {
            background-color: #e5e7eb;
            color: #374151;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
        }
        .btn-secondary:hover {
            background-color: #d1d5db;
        }
        .input-field {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            outline: none;
        }
        .input-field:focus {
            border-color: #0284c7;
            box-shadow: 0 0 0 3px rgba(2, 132, 199, 0.1);
        }
        .card {
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .progress-bar {
            width: 100%;
            height: 0.5rem;
            background-color: #e5e7eb;
            border-radius: 9999px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background-color: #0284c7;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { createElement: h } = React;

        // Mock API functions
        const mockApi = {
            createUser: async () => ({ id: 1, email: 'demo@example.com', username: 'demo_user' }),
            createQuestionnaire: async (userId, data) => ({ id: 1, user_id: userId, ...data }),
            createHabitTarget: async (userId, data) => ({ id: 1, user_id: userId, ...data }),
            getHabitTargets: async (userId) => ({
                data: [
                    { id: 1, habit_type: 'water', target_value: 2000, target_unit: 'ml', is_active: true },
                    { id: 2, habit_type: 'meals', target_value: 3, target_unit: 'count', is_active: true },
                    { id: 3, habit_type: 'exercise', target_value: 150, target_unit: 'minutes', is_active: true },
                    { id: 4, habit_type: 'sleep', target_value: 8, target_unit: 'hours', is_active: true }
                ]
            }),
            createHabitLog: async (userId, data) => ({ id: 1, user_id: userId, ...data }),
            getHabitLogs: async (userId, filters) => ({
                data: [
                    { id: 1, habit_type: 'water', logged_value: 1500, unit: 'ml', log_date: new Date().toISOString().split('T')[0], created_at: new Date().toISOString() },
                    { id: 2, habit_type: 'meals', logged_value: 2, unit: 'count', log_date: new Date().toISOString().split('T')[0], created_at: new Date().toISOString() }
                ]
            })
        };

        // Questionnaire Component
        function Questionnaire({ onComplete }) {
            const [currentStep, setCurrentStep] = useState(0);
            const [formData, setFormData] = useState({
                sleep_hours: 8,
                water_goal_ml: 2000,
                meal_frequency: 3,
                exercise_frequency: 3,
                exercise_duration: 30,
                stress_level: 'moderate',
                energy_level: 'moderate',
                mood_tracking: false,
                weight_goal: 'maintain',
                target_weight_kg: 70
            });

            const steps = [
                { title: 'Sleep Habits', icon: 'ðŸŒ™' },
                { title: 'Hydration Goals', icon: 'ðŸ’§' },
                { title: 'Meal Planning', icon: 'ðŸ½ï¸' },
                { title: 'Exercise Routine', icon: 'ðŸƒ' },
                { title: 'Health & Wellness', icon: 'â¤ï¸' },
                { title: 'Goals & Tracking', icon: 'ðŸŽ¯' }
            ];

            const handleInputChange = (field, value) => {
                setFormData(prev => ({ ...prev, [field]: value }));
            };

            const handleNext = () => {
                if (currentStep < steps.length - 1) {
                    setCurrentStep(currentStep + 1);
                } else {
                    onComplete(formData);
                }
            };

            const handlePrevious = () => {
                if (currentStep > 0) {
                    setCurrentStep(currentStep - 1);
                }
            };

            const renderStepContent = () => {
                switch (currentStep) {
                    case 0:
                        return h('div', { className: 'space-y-6' },
                            h('div', { className: 'text-center' },
                                h('div', { className: 'text-4xl mb-4' }, 'ðŸŒ™'),
                                h('h2', { className: 'text-xl font-semibold text-gray-800 mb-2' }, 'Sleep Habits'),
                                h('p', { className: 'text-gray-600' }, 'Tell us about your sleep patterns')
                            ),
                            h('div', null,
                                h('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'How many hours do you sleep per night?'),
                                h('input', {
                                    type: 'number',
                                    min: '4',
                                    max: '12',
                                    step: '0.5',
                                    value: formData.sleep_hours,
                                    onChange: (e) => handleInputChange('sleep_hours', parseFloat(e.target.value)),
                                    className: 'input-field'
                                })
                            )
                        );
                    case 1:
                        return h('div', { className: 'space-y-6' },
                            h('div', { className: 'text-center' },
                                h('div', { className: 'text-4xl mb-4' }, 'ðŸ’§'),
                                h('h2', { className: 'text-xl font-semibold text-gray-800 mb-2' }, 'Hydration Goals'),
                                h('p', { className: 'text-gray-600' }, 'Set your daily water intake target')
                            ),
                            h('div', null,
                                h('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Daily water goal (ml)'),
                                h('input', {
                                    type: 'number',
                                    min: '500',
                                    max: '5000',
                                    step: '100',
                                    value: formData.water_goal_ml,
                                    onChange: (e) => handleInputChange('water_goal_ml', parseInt(e.target.value)),
                                    className: 'input-field'
                                }),
                                h('p', { className: 'text-sm text-gray-500 mt-1' }, 'Recommended: 2000-3000ml per day')
                            )
                        );
                    case 2:
                        return h('div', { className: 'space-y-6' },
                            h('div', { className: 'text-center' },
                                h('div', { className: 'text-4xl mb-4' }, 'ðŸ½ï¸'),
                                h('h2', { className: 'text-xl font-semibold text-gray-800 mb-2' }, 'Meal Planning'),
                                h('p', { className: 'text-gray-600' }, 'How often do you eat?')
                            ),
                            h('div', null,
                                h('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Meals per day'),
                                h('input', {
                                    type: 'number',
                                    min: '1',
                                    max: '6',
                                    value: formData.meal_frequency,
                                    onChange: (e) => handleInputChange('meal_frequency', parseInt(e.target.value)),
                                    className: 'input-field'
                                })
                            )
                        );
                    case 3:
                        return h('div', { className: 'space-y-6' },
                            h('div', { className: 'text-center' },
                                h('div', { className: 'text-4xl mb-4' }, 'ðŸƒ'),
                                h('h2', { className: 'text-xl font-semibold text-gray-800 mb-2' }, 'Exercise Routine'),
                                h('p', { className: 'text-gray-600' }, 'Tell us about your fitness habits')
                            ),
                            h('div', null,
                                h('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Exercise days per week'),
                                h('input', {
                                    type: 'number',
                                    min: '0',
                                    max: '7',
                                    value: formData.exercise_frequency,
                                    onChange: (e) => handleInputChange('exercise_frequency', parseInt(e.target.value)),
                                    className: 'input-field'
                                })
                            ),
                            h('div', null,
                                h('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Duration per session (minutes)'),
                                h('input', {
                                    type: 'number',
                                    min: '5',
                                    max: '180',
                                    step: '5',
                                    value: formData.exercise_duration,
                                    onChange: (e) => handleInputChange('exercise_duration', parseInt(e.target.value)),
                                    className: 'input-field'
                                })
                            )
                        );
                    case 4:
                        return h('div', { className: 'space-y-6' },
                            h('div', { className: 'text-center' },
                                h('div', { className: 'text-4xl mb-4' }, 'â¤ï¸'),
                                h('h2', { className: 'text-xl font-semibold text-gray-800 mb-2' }, 'Health & Wellness'),
                                h('p', { className: 'text-gray-600' }, 'Help us understand your current state')
                            ),
                            h('div', null,
                                h('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Current stress level'),
                                h('select', {
                                    value: formData.stress_level,
                                    onChange: (e) => handleInputChange('stress_level', e.target.value),
                                    className: 'input-field'
                                },
                                    h('option', { value: 'low' }, 'Low'),
                                    h('option', { value: 'moderate' }, 'Moderate'),
                                    h('option', { value: 'high' }, 'High')
                                )
                            ),
                            h('div', null,
                                h('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Energy level'),
                                h('select', {
                                    value: formData.energy_level,
                                    onChange: (e) => handleInputChange('energy_level', e.target.value),
                                    className: 'input-field'
                                },
                                    h('option', { value: 'low' }, 'Low'),
                                    h('option', { value: 'moderate' }, 'Moderate'),
                                    h('option', { value: 'high' }, 'High')
                                )
                            )
                        );
                    case 5:
                        return h('div', { className: 'space-y-6' },
                            h('div', { className: 'text-center' },
                                h('div', { className: 'text-4xl mb-4' }, 'ðŸŽ¯'),
                                h('h2', { className: 'text-xl font-semibold text-gray-800 mb-2' }, 'Goals & Tracking'),
                                h('p', { className: 'text-gray-600' }, 'Set your personal goals')
                            ),
                            h('div', null,
                                h('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Weight goal'),
                                h('select', {
                                    value: formData.weight_goal,
                                    onChange: (e) => handleInputChange('weight_goal', e.target.value),
                                    className: 'input-field'
                                },
                                    h('option', { value: 'lose' }, 'Lose weight'),
                                    h('option', { value: 'maintain' }, 'Maintain weight'),
                                    h('option', { value: 'gain' }, 'Gain weight')
                                )
                            ),
                            h('div', null,
                                h('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Target weight (kg)'),
                                h('input', {
                                    type: 'number',
                                    min: '30',
                                    max: '200',
                                    step: '0.1',
                                    value: formData.target_weight_kg,
                                    onChange: (e) => handleInputChange('target_weight_kg', parseFloat(e.target.value)),
                                    className: 'input-field'
                                })
                            ),
                            h('div', { className: 'flex items-center' },
                                h('input', {
                                    type: 'checkbox',
                                    id: 'mood_tracking',
                                    checked: formData.mood_tracking,
                                    onChange: (e) => handleInputChange('mood_tracking', e.target.checked),
                                    className: 'h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded'
                                }),
                                h('label', { htmlFor: 'mood_tracking', className: 'ml-2 block text-sm text-gray-700' }, 'Enable mood tracking')
                            )
                        );
                    default:
                        return null;
                }
            };

            return h('div', { className: 'min-h-screen bg-gray-50' },
                h('div', { className: 'mobile-container' },
                    // Progress Bar
                    h('div', { className: 'mb-8' },
                        h('div', { className: 'flex justify-between text-sm text-gray-600 mb-2' },
                            h('span', null, `Step ${currentStep + 1} of ${steps.length}`),
                            h('span', null, `${Math.round(((currentStep + 1) / steps.length) * 100)}%`)
                        ),
                        h('div', { className: 'progress-bar' },
                            h('div', {
                                className: 'progress-fill',
                                style: { width: `${((currentStep + 1) / steps.length) * 100}%` }
                            })
                        )
                    ),
                    // Step Content
                    h('div', { className: 'card mb-8' }, renderStepContent()),
                    // Navigation
                    h('div', { className: 'flex justify-between' },
                        h('button', {
                            onClick: handlePrevious,
                            disabled: currentStep === 0,
                            className: `btn-secondary ${currentStep === 0 ? 'opacity-50 cursor-not-allowed' : ''}`
                        }, 'Previous'),
                        h('button', {
                            onClick: handleNext,
                            className: 'btn-primary'
                        }, currentStep === steps.length - 1 ? 'Complete Setup' : 'Next')
                    )
                )
            );
        }

        // Dashboard Component
        function Dashboard({ userId, onViewChange }) {
            const [habitTargets, setHabitTargets] = useState([]);
            const [todayLogs, setTodayLogs] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadDashboardData();
            }, [userId]);

            const loadDashboardData = async () => {
                try {
                    setLoading(true);
                    const targetsResponse = await mockApi.getHabitTargets(userId);
                    const logsResponse = await mockApi.getHabitLogs(userId, {});
                    setHabitTargets(targetsResponse.data);
                    setTodayLogs(logsResponse.data);
                } catch (error) {
                    console.error('Error loading dashboard data:', error);
                } finally {
                    setLoading(false);
                }
            };

            const getHabitIcon = (habitType) => {
                const icons = {
                    water: 'ðŸ’§',
                    meals: 'ðŸ½ï¸',
                    exercise: 'ðŸƒ',
                    sleep: 'ðŸŒ™'
                };
                return icons[habitType] || 'ðŸŽ¯';
            };

            const getHabitColor = (habitType) => {
                const colors = {
                    water: 'text-blue-600',
                    meals: 'text-green-600',
                    exercise: 'text-orange-600',
                    sleep: 'text-purple-600'
                };
                return colors[habitType] || 'text-gray-600';
            };

            const getTotalLoggedValue = (habitType) => {
                const logs = todayLogs.filter(log => log.habit_type === habitType);
                return logs.reduce((sum, log) => sum + log.logged_value, 0);
            };

            if (loading) {
                return h('div', { className: 'flex items-center justify-center min-h-screen' },
                    h('div', { className: 'text-center' },
                        h('div', { className: 'animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4' }),
                        h('p', { className: 'text-gray-600' }, 'Loading dashboard...')
                    )
                );
            }

            return h('div', { className: 'min-h-screen bg-gray-50' },
                h('div', { className: 'mobile-container' },
                    // Header
                    h('div', { className: 'text-center mb-8' },
                        h('h1', { className: 'text-2xl font-bold text-gray-800 mb-2' }, "Today's Progress"),
                        h('p', { className: 'text-gray-600' }, new Date().toLocaleDateString('en-US', { 
                            weekday: 'long', 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric' 
                        }))
                    ),
                    // Quick Stats
                    h('div', { className: 'grid grid-cols-2 gap-4 mb-6' },
                        h('div', { className: 'card text-center' },
                            h('div', { className: 'text-2xl font-bold text-blue-600' }, habitTargets.length),
                            h('div', { className: 'text-sm text-gray-600' }, 'Active Habits')
                        ),
                        h('div', { className: 'card text-center' },
                            h('div', { className: 'text-2xl font-bold text-green-600' }, '2'),
                            h('div', { className: 'text-sm text-gray-600' }, 'Goals Met')
                        )
                    ),
                    // Habit Progress Cards
                    h('div', { className: 'space-y-4 mb-8' },
                        ...habitTargets.map((target) => {
                            const totalLogged = getTotalLoggedValue(target.habit_type);
                            const progress = (totalLogged / target.target_value) * 100;
                            
                            return h('div', { key: target.id, className: 'card' },
                                h('div', { className: 'flex items-center justify-between mb-3' },
                                    h('div', { className: 'flex items-center' },
                                        h('div', { className: 'text-2xl mr-3' }, getHabitIcon(target.habit_type)),
                                        h('div', null,
                                            h('h3', { className: 'font-semibold text-gray-800 capitalize' }, target.habit_type),
                                            h('p', { className: 'text-sm text-gray-600' }, `${totalLogged.toFixed(0)} / ${target.target_value.toFixed(0)}`)
                                        )
                                    ),
                                    h('div', { className: 'text-lg font-bold text-blue-600' }, `${progress.toFixed(0)}%`)
                                ),
                                h('div', { className: 'progress-bar mb-2' },
                                    h('div', {
                                        className: 'progress-fill',
                                        style: { width: `${Math.min(progress, 100)}%` }
                                    })
                                ),
                                h('div', { className: 'flex justify-between text-xs text-gray-500' },
                                    h('span', null, `Goal: ${target.target_value.toFixed(0)}`),
                                    h('span', null, 'Streak: 3 days')
                                )
                            );
                        })
                    ),
                    // Action Buttons
                    h('div', { className: 'grid grid-cols-2 gap-4' },
                        h('button', {
                            onClick: () => onViewChange('tracker'),
                            className: 'btn-primary flex items-center justify-center'
                        }, 'ðŸŽ¯ Log Habits'),
                        h('button', {
                            onClick: () => onViewChange('progress'),
                            className: 'btn-secondary flex items-center justify-center'
                        }, 'ðŸ“ˆ View Progress')
                    )
                )
            );
        }

        // Main App Component
        function App() {
            const [currentUser, setCurrentUser] = useState(null);
            const [hasQuestionnaire, setHasQuestionnaire] = useState(false);
            const [currentView, setCurrentView] = useState('questionnaire');
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                initializeApp();
            }, []);

            const initializeApp = async () => {
                try {
                    setLoading(true);
                    const user = await mockApi.createUser();
                    setCurrentUser(user);
                    setHasQuestionnaire(false);
                } catch (error) {
                    console.error('Error initializing app:', error);
                } finally {
                    setLoading(false);
                }
            };

            const handleQuestionnaireComplete = async (questionnaireData) => {
                if (!currentUser) return;
                
                try {
                    await mockApi.createQuestionnaire(currentUser.id, questionnaireData);
                    setHasQuestionnaire(true);
                    setCurrentView('dashboard');
                } catch (error) {
                    console.error('Error saving questionnaire:', error);
                }
            };

            if (loading) {
                return h('div', { className: 'flex items-center justify-center min-h-screen' },
                    h('div', { className: 'text-center' },
                        h('div', { className: 'animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4' }),
                        h('p', { className: 'text-gray-600' }, 'Loading...')
                    )
                );
            }

            if (!currentUser) {
                return h('div', { className: 'mobile-container flex items-center justify-center' },
                    h('div', { className: 'text-center' },
                        h('h1', { className: 'text-2xl font-bold text-gray-800 mb-4' }, 'Welcome to Nutrition AI'),
                        h('p', { className: 'text-gray-600' }, 'Loading your profile...')
                    )
                );
            }

            if (!hasQuestionnaire) {
                return h(Questionnaire, { onComplete: handleQuestionnaireComplete });
            }

            if (currentView === 'dashboard') {
                return h(Dashboard, { userId: currentUser.id, onViewChange: setCurrentView });
            }

            return h('div', { className: 'mobile-container' },
                h('h1', { className: 'text-2xl font-bold text-gray-800 mb-4' }, 'Habit Tracker'),
                h('p', { className: 'text-gray-600 mb-6' }, 'This is a demo of the mobile-optimized React frontend.'),
                h('div', { className: 'space-y-4' },
                    h('div', { className: 'card' },
                        h('h3', { className: 'font-semibold text-gray-800 mb-2' }, 'âœ… Features Implemented'),
                        h('ul', { className: 'text-sm text-gray-600 space-y-1' },
                            h('li', null, 'â€¢ Multi-step questionnaire with progress bar'),
                            h('li', null, 'â€¢ Mobile-optimized responsive design'),
                            h('li', null, 'â€¢ Interactive dashboard with progress cards'),
                            h('li', null, 'â€¢ Habit tracking interface'),
                            h('li', null, 'â€¢ Progress charts and analytics'),
                            h('li', null, 'â€¢ Clean, modern UI with Tailwind CSS')
                        )
                    ),
                    h('div', { className: 'card' },
                        h('h3', { className: 'font-semibold text-gray-800 mb-2' }, 'ðŸš€ Next Steps'),
                        h('ul', { className: 'text-sm text-gray-600 space-y-1' },
                            h('li', null, 'â€¢ Install Node.js to run the full React app'),
                            h('li', null, 'â€¢ Start the FastAPI backend server'),
                            h('li', null, 'â€¢ Run npm install && npm start in frontend folder'),
                            h('li', null, 'â€¢ Test with real API endpoints')
                        )
                    ),
                    h('button', {
                        onClick: () => setCurrentView('questionnaire'),
                        className: 'w-full btn-primary'
                    }, 'Start Questionnaire Demo')
                )
            );
        }

        // Render the app
        ReactDOM.render(h(App), document.getElementById('root'));
    </script>
</body>
</html>
